# 晶莹投屏 - HTML5 WebRTC屏幕共享React应用

一个基于React、HTML5屏幕采集API和WebRTC技术的投屏Web应用，采用柠檬、芒果、绿叶素配色方案，打造晶莹剔透的UI效果。

## 🎨 全新设计

### 多页面架构
- **欢迎页** - 优雅的首页，提供房间加入和创建功能
- **房间页** - 专业的屏幕控制界面和预览视图
- **组件化设计** - 模块化React组件，易于维护和扩展

### 技术栈升级
- **React 18** - 前端框架
- **React Router** - 单页应用路由管理
- **Webpack 5** - 模块打包和构建工具
- **CSS3 + 玻璃形态设计** - 晶莹剔透的视觉效果

## ✨ 特性

### 🎬 推流端功能（屏幕共享发送方）

- 🖥️ **高清屏幕共享** - 支持从480p到4K的多种画质选择
- 🎚️ **实时画质调整** - 在共享过程中动态调整分辨率
- 🎞️ **帧率控制** - 支持15/24/30/60 FPS多档帧率
- 📊 **码率调节** - 1-20 Mbps可调节码率，自适应网络环境
- 🎵 **音频配置** - 支持音频开关、回声消除、噪音抑制
- 🔧 **编码器选择** - 支持H.264、VP8、VP9、AV1等多种编码器
- ⚙️ **WebRTC优化** - 硬件加速、自适应码率、ICE传输策略配置
- 📈 **本地统计** - 实时显示分辨率、帧率、码率、编码器信息

### 👀 观看端功能（屏幕共享接收方）

- 📺 **高质量观看** - 自动适配最佳播放质量
- 📊 **详细统计信息** - 实时显示多项关键指标：
  - 📐 **分辨率** - 当前接收视频分辨率
  - �️ **帧率 (FPS)** - 实时帧率监控
  - 💾 **码率** - 当前接收码率（带颜色指示）
  - 🔧 **编码器** - 当前使用的视频编码器
  - 🔗 **P2P连接状态** - 显示是否成功P2P直连（打洞成功）
  - 📡 **连接状态** - WebRTC连接状态（connected/connecting/failed等）
  - ⏱️ **延迟 (RTT)** - 往返时间延迟监控
  - 📉 **抖动** - 网络抖动指标
  - ⚠️ **丢包率** - 数据包丢失率统计
  - 🌐 **ICE连接状态** - ICE候选收集和连接状态
- 🎨 **彩色指标** - 根据质量自动着色（绿色=优秀，黄色=一般，橙色=较差）
- 🔍 **详情面板** - 可展开/折叠的详细连接信息面板
- 🎛️ **音频控制** - 独立音量控制和静音功能
- 📱 **全屏播放** - 支持全屏观看模式

### 🌐 通用功能

- 🔒 **安全可靠** - 无需安装插件，浏览器原生支持
- 📱 **响应式设计** - 完美适配桌面和移动设备
- ⚡ **实时同步** - 多人房间，实时音视频同步
- 🎨 **UI设计** - 晶莹剔透的玻璃效果，柠檬芒果绿叶素配色
- 🔔 **智能通知** - 实时连接状态和用户动态通知

## 🚀 快速开始

### 环境要求

- Node.js 16.0+
- 现代浏览器 (Chrome 72+, Firefox 66+, Safari 13+)
- HTTPS 环境 (屏幕共享API要求)

### 安装和运行

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd crystal-screen-share
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **构建前端应用**
   ```bash
   npm run build
   ```

4. **启动服务器**
   ```bash
   # 开发模式 (后端自动重启)
   npm run dev
   
   # 生产模式
   npm start
   ```

5. **访问应用**
   - 打开浏览器访问 `http://localhost:3000`
   - 首先进入欢迎页，选择加入房间或创建新房间
   - 进入房间页面后即可开始屏幕共享

### 开发模式

```bash
# 监听前端代码变化并自动构建
npm run dev:webpack

# 同时运行后端开发服务器和前端构建监听
npm run dev:all
```

## 🎮 使用方法

### 基本流程

1. **访问欢迎页**
   - 在浏览器中打开应用主页
   - 查看应用介绍和功能特性

2. **加入或创建房间**
   - 输入现有房间号并点击"加入房间"
   - 或点击"创建新房间"自动生成房间号
   - 系统会自动跳转到房间页面

3. **房间页面操作**
   - **左侧控制面板**: 配置推流设置和开始屏幕共享
   - **右侧视频区域**: 显示本地预览和远程屏幕
   - **头部导航**: 显示房间信息和连接状态

4. **配置推流设置**
   - **视频质量**: 选择480p、720p、1080p、2K或4K
   - **帧率**: 选择15、24、30或60 FPS
   - **码率**: 使用滑块调整1-20 Mbps
   - **编码器**: 选择自动、H.264、VP8、VP9或AV1
   - **音频设置**: 
     - 启用/禁用音频
     - 回声消除开关
     - 噪音抑制开关
   - **WebRTC配置**: 硬件加速、自适应码率设置

5. **开始屏幕共享**
   - 点击"开始共享屏幕"按钮
   - 选择要共享的屏幕、窗口或浏览器标签页
   - 确认开始共享

6. **实时监控和控制**
   - 查看本地流统计信息（分辨率、帧率、码率、编码器）
   - 观看其他用户的屏幕共享
   - 查看远程流详细统计（连接状态、延迟、丢包率等）
   - 控制音频静音和全屏播放

7. **结束会话**
   - 点击"停止共享"结束屏幕共享
   - 点击"离开房间"退出会话

### 统计指标说明

#### 推流端指标
- **分辨率**: 当前推流的视频分辨率
- **帧率**: 实际发送帧率
- **码率**: 实际发送码率（实时计算）
- **编码器**: 当前使用的视频编码器

#### 观看端指标
- **分辨率**: 接收到的视频分辨率
- **帧率**: 实际播放帧率
- **码率**: 
  - 🟢 绿色: ≥3 Mbps (优秀)
  - 🟡 黄色: 1-3 Mbps (一般)
  - 🟠 橙色: <1 Mbps (较差)
- **P2P连接**:
  - ✅ 已连接: 成功建立P2P直连（NAT打洞成功）
  - ⚠️ 中继模式: 通过TURN服务器中继
- **延迟(RTT)**:
  - 🟢 <50ms: 优秀
  - 🟡 50-150ms: 一般
  - 🟠 >150ms: 较差
- **丢包率**:
  - 🟢 <1%: 优秀
  - 🟡 1-5%: 一般
  - 🟠 >5%: 较差
- **抖动**: 网络延迟波动，单位ms，越低越好

### 快捷键

- `Enter` - 快速加入房间
- `Esc` - 停止屏幕共享 (仅分享者)

## 🔧 技术架构

### 前端技术栈

- **React 18** - 前端框架，支持并发特性
- **React Router v6** - 单页应用路由管理
- **React Hooks** - 函数式组件状态管理
- **CSS3 + 玻璃形态设计** - UI设计
- **Webpack 5** - 模块打包和构建工具
- **Babel** - JavaScript编译器
- **WebRTC** - 点对点音视频通信
- **Socket.IO Client** - 实时双向通信

### 后端技术栈

- **Node.js** - JavaScript运行时
- **Express.js** - Web框架
- **Socket.IO** - WebSocket实时通信
- **CORS** - 跨域资源共享

### 核心API

- **getDisplayMedia()** - H5屏幕采集API
- **RTCPeerConnection** - WebRTC连接管理
- **Socket.IO** - 信令服务器通信

### 架构特点

- **组件化设计** - 模块化React组件，便于维护和扩展
- **Hook驱动** - 使用自定义Hook管理WebRTC和通知状态
- **服务分离** - WebRTC逻辑封装在独立的服务类中
- **响应式设计** - 完美适配桌面和移动设备
- **类型安全** - 良好的代码组织和错误处理

## 📁 项目结构

```
crystal-screen-share/
├── server/                    # 后端服务器
│   └── index.js              # Express服务器和Socket.IO
├── src/                      # React前端源码
│   ├── components/           # React组件
│   │   ├── Header.js         # 头部导航组件
│   │   ├── ControlPanel.js   # 控制面板组件
│   │   ├── SettingsPanel.js  # 设置面板组件
│   │   ├── VideoSection.js   # 视频区域组件
│   │   ├── VideoPlayer.js    # 视频播放器组件
│   │   ├── EmptyState.js     # 空状态组件
│   │   ├── NotificationProvider.js # 通知Provider
│   │   └── NotificationContainer.js # 通知容器
│   ├── pages/               # 页面组件
│   │   ├── WelcomePage.js   # 欢迎页
│   │   └── RoomPage.js      # 房间页
│   ├── hooks/               # React Hooks
│   │   ├── useWebRTC.js     # WebRTC Hook
│   │   └── useNotification.js # 通知Hook
│   ├── services/            # 服务层
│   │   └── WebRTCService.js # WebRTC服务
│   ├── utils/               # 工具函数
│   │   └── helpers.js       # 辅助函数
│   ├── styles/              # 样式文件
│   │   └── globals.css      # 全局样式
│   ├── index.html           # HTML模板
│   ├── index.js             # React入口文件
│   └── App.js               # 主应用组件
├── public/                  # 静态资源
│   ├── dist/                # 构建产物
│   └── index.html           # 最终HTML文件
├── webpack.config.js        # Webpack配置
├── .babelrc                 # Babel配置
├── package.json             # 项目配置
└── README.md                # 项目文档
```

## 🌈 设计系统

### 配色方案

- **柠檬色系** - 主要交互元素
  - Primary: `#facc15`
  - Light: `#fef9c3`
  - Dark: `#ca8a04`

- **芒果色系** - 次要元素和强调
  - Primary: `#f97316`
  - Light: `#fed7aa`
  - Dark: `#ea580c`

- **绿叶素系** - 成功状态和自然元素
  - Primary: `#22c55e`
  - Light: `#bbf7d0`
  - Dark: `#16a34a`

### 玻璃形态效果

- 背景模糊: `backdrop-filter: blur(20px)`
- 透明度: `rgba(255, 255, 255, 0.1)`
- 边框: `1px solid rgba(255, 255, 255, 0.2)`
- 阴影: `0 8px 32px rgba(0, 0, 0, 0.1)`

## 🔍 API文档

### Socket.IO事件

#### 客户端发送

- `join-room` - 加入房间
- `start-screen-share` - 开始屏幕共享
- `stop-screen-share` - 停止屏幕共享
- `offer` - WebRTC offer信令
- `answer` - WebRTC answer信令
- `ice-candidate` - ICE候选信令

#### 服务端发送

- `room-info` - 房间信息
- `user-joined` - 用户加入
- `user-left` - 用户离开
- `screen-share-started` - 屏幕共享开始
- `screen-share-stopped` - 屏幕共享停止

### REST API

- `GET /api/health` - 服务器健康检查
- `GET /api/rooms` - 获取活跃房间列表

## 🛠️ 开发指南

### 本地开发

1. **环境设置**
   ```bash
   # 安装开发依赖
   npm install
   
   # 启动开发模式
   npm run dev:all
   ```

2. **代码规范**
   - 使用ES6+语法
   - 遵循模块化设计
   - 添加适当的注释

3. **测试流程**
   - 在多个浏览器标签页测试
   - 验证不同屏幕分辨率
   - 测试网络异常情况

### 常见问题

**Q: 屏幕共享不工作？**
A: 确保使用HTTPS协议，HTTP环境下屏幕共享API不可用。

**Q: 无法听到音频？**
A: 检查浏览器音频权限，确保视频元素未静音。

**Q: 连接失败？**
A: 检查防火墙设置，确保WebSocket连接正常。

## 🔒 安全性

- 所有通信基于WebRTC加密
- 不存储任何用户数据
- 房间数据仅在内存中保持
- 支持HTTPS部署

## 📱 浏览器兼容性

| 浏览器 | 版本要求 | 屏幕共享 | WebRTC |
|--------|----------|----------|--------|
| Chrome | 72+ | ✅ | ✅ |
| Firefox | 66+ | ✅ | ✅ |
| Safari | 13+ | ✅ | ✅ |
| Edge | 79+ | ✅ | ✅ |

## 🤝 贡献

欢迎提交问题和功能请求！

1. Fork 项目
2. 创建特性分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 🙏 致谢

- WebRTC社区的技术支持
- Socket.IO团队的优秀框架
- 现代浏览器对Web标准的支持

---

**晶莹投屏 v2.0** - 基于React的HTML5 WebRTC屏幕共享应用，让屏幕共享变得简单而优雅 ✨

### 🎉 全新特性

- 🏠 **欢迎页设计** - 优雅的首页体验
- 🏢 **房间管理** - 专业的房间页面
- ⚛️ **React架构** - 前端框架
- 🎨 **组件化UI** - 模块化设计理念
- 📱 **响应式体验** - 完美适配各种设备
- 🔧 **Hook驱动** - 优雅的状态管理
- 🚀 **性能优化** - Webpack构建优化

体验地址: http://localhost:3000