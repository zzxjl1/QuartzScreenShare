# 晶莹投屏 - 现代化屏幕共享Web应用

一个基于H5屏幕采集API和WebRTC技术的现代化投屏Web应用，采用柠檬、芒果、绿叶素配色方案，打造晶莹剔透的UI效果。

## ✨ 特性

### 🎬 推流端功能（屏幕共享发送方）

- 🖥️ **高清屏幕共享** - 支持从480p到4K的多种画质选择
- 🎚️ **实时画质调整** - 在共享过程中动态调整分辨率
- 🎞️ **帧率控制** - 支持15/24/30/60 FPS多档帧率
- 📊 **码率调节** - 1-20 Mbps可调节码率，自适应网络环境
- 🎵 **音频配置** - 支持音频开关、回声消除、噪音抑制
- 🔧 **编码器选择** - 支持H.264、VP8、VP9、AV1等多种编码器
- ⚙️ **WebRTC优化** - 硬件加速、自适应码率、ICE传输策略配置
- 📈 **本地统计** - 实时显示分辨率、帧率、码率、编码器信息

### 👀 观看端功能（屏幕共享接收方）

- 📺 **高质量观看** - 自动适配最佳播放质量
- 📊 **详细统计信息** - 实时显示多项关键指标：
  - 📐 **分辨率** - 当前接收视频分辨率
  - �️ **帧率 (FPS)** - 实时帧率监控
  - 💾 **码率** - 当前接收码率（带颜色指示）
  - 🔧 **编码器** - 当前使用的视频编码器
  - 🔗 **P2P连接状态** - 显示是否成功P2P直连（打洞成功）
  - 📡 **连接状态** - WebRTC连接状态（connected/connecting/failed等）
  - ⏱️ **延迟 (RTT)** - 往返时间延迟监控
  - 📉 **抖动** - 网络抖动指标
  - ⚠️ **丢包率** - 数据包丢失率统计
  - 🌐 **ICE连接状态** - ICE候选收集和连接状态
- 🎨 **彩色指标** - 根据质量自动着色（绿色=优秀，黄色=一般，橙色=较差）
- 🔍 **详情面板** - 可展开/折叠的详细连接信息面板
- 🎛️ **音频控制** - 独立音量控制和静音功能
- 📱 **全屏播放** - 支持全屏观看模式

### 🌐 通用功能

- 🔒 **安全可靠** - 无需安装插件，浏览器原生支持
- 📱 **响应式设计** - 完美适配桌面和移动设备
- ⚡ **实时同步** - 多人房间，实时音视频同步
- 🎨 **现代化UI** - 晶莹剔透的玻璃效果，柠檬芒果绿叶素配色
- 🔔 **智能通知** - 实时连接状态和用户动态通知

## 🚀 快速开始

### 环境要求

- Node.js 16.0+
- 现代浏览器 (Chrome 72+, Firefox 66+, Safari 13+)
- HTTPS 环境 (屏幕共享API要求)

### 安装和运行

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd screen-share
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **启动开发服务器**
   ```bash
   # 启动后端服务器
   npm run dev
   
   # 在新终端窗口启动前端服务器
   npm run client
   
   # 或者同时启动前后端
   npm run dev:all
   ```

4. **访问应用**
   - 打开浏览器访问 `http://localhost:8080`
   - 服务器运行在 `http://localhost:3000`

### 生产部署

1. **构建项目**
   ```bash
   npm install --production
   ```

2. **启动生产服务器**
   ```bash
   npm start
   ```

## 🎮 使用方法

### 基本流程

1. **加入房间**
   - 输入房间号或创建新房间
   - 点击"加入房间"按钮

2. **配置推流设置（发送方）**
   - **视频质量**: 选择480p、720p、1080p、1440p或4K
   - **帧率**: 选择15、24、30或60 FPS
   - **码率**: 使用滑块调整1-20 Mbps
   - **编码器**: 选择自动、H.264、VP8、VP9或AV1
   - **音频设置**: 
     - 启用/禁用音频
     - 回声消除开关
     - 噪音抑制开关
   - **WebRTC配置**:
     - 硬件加速
     - 自适应码率
     - ICE传输策略（全部候选/仅中继）

3. **开始屏幕共享**
   - 点击"开始共享屏幕"按钮
   - 选择要共享的屏幕或窗口
   - 确认开始共享
   - 查看本地统计信息（分辨率、帧率、码率、编码器）

4. **实时调整设置**
   - 在共享过程中可以随时调整画质、帧率和码率
   - 设置会实时应用到推流中

5. **观看屏幕共享（接收方）**
   - 其他用户加入同一房间
   - 自动接收屏幕共享流
   - 查看详细统计信息：
     - 基础统计（底部常驻显示）：分辨率、帧率、码率、编码器
     - 详细信息（点击ℹ️按钮展开）：
       - P2P连接状态
       - WebRTC连接状态
       - 延迟(RTT)
       - 网络抖动
       - 丢包率
   - 支持音频控制和全屏播放

### 统计指标说明

#### 推流端指标
- **分辨率**: 当前推流的视频分辨率
- **帧率**: 实际发送帧率
- **码率**: 实际发送码率（实时计算）
- **编码器**: 当前使用的视频编码器

#### 观看端指标
- **分辨率**: 接收到的视频分辨率
- **帧率**: 实际播放帧率
- **码率**: 
  - 🟢 绿色: ≥3 Mbps (优秀)
  - 🟡 黄色: 1-3 Mbps (一般)
  - 🟠 橙色: <1 Mbps (较差)
- **P2P连接**:
  - ✅ 已连接: 成功建立P2P直连（NAT打洞成功）
  - ⚠️ 中继模式: 通过TURN服务器中继
- **延迟(RTT)**:
  - 🟢 <50ms: 优秀
  - 🟡 50-150ms: 一般
  - 🟠 >150ms: 较差
- **丢包率**:
  - 🟢 <1%: 优秀
  - 🟡 1-5%: 一般
  - 🟠 >5%: 较差
- **抖动**: 网络延迟波动，单位ms，越低越好

### 快捷键

- `Enter` - 快速加入房间
- `Esc` - 停止屏幕共享 (仅分享者)

## 🔧 技术架构

### 前端技术栈

- **HTML5** - 语义化标记和现代Web API
- **CSS3** - 玻璃形态设计和响应式布局
- **JavaScript (ES6+)** - 模块化和面向对象编程
- **WebRTC** - 点对点音视频通信
- **Socket.IO Client** - 实时双向通信

### 后端技术栈

- **Node.js** - JavaScript运行时
- **Express.js** - Web框架
- **Socket.IO** - WebSocket实时通信
- **CORS** - 跨域资源共享

### 核心API

- **getDisplayMedia()** - H5屏幕采集API
- **RTCPeerConnection** - WebRTC连接管理
- **Socket.IO** - 信令服务器通信

## 📁 项目结构

```
screen-share/
├── server/                 # 后端服务器
│   └── index.js           # Express服务器和Socket.IO
├── public/                # 前端静态文件
│   ├── index.html         # 主页面
│   ├── css/
│   │   └── style.css      # 样式文件
│   └── js/
│       ├── app.js         # 主应用逻辑
│       └── webrtc.js      # WebRTC管理
├── .github/
│   └── copilot-instructions.md
├── package.json           # 项目配置
└── README.md             # 项目文档
```

## 🌈 设计系统

### 配色方案

- **柠檬色系** - 主要交互元素
  - Primary: `#facc15`
  - Light: `#fef9c3`
  - Dark: `#ca8a04`

- **芒果色系** - 次要元素和强调
  - Primary: `#f97316`
  - Light: `#fed7aa`
  - Dark: `#ea580c`

- **绿叶素系** - 成功状态和自然元素
  - Primary: `#22c55e`
  - Light: `#bbf7d0`
  - Dark: `#16a34a`

### 玻璃形态效果

- 背景模糊: `backdrop-filter: blur(20px)`
- 透明度: `rgba(255, 255, 255, 0.1)`
- 边框: `1px solid rgba(255, 255, 255, 0.2)`
- 阴影: `0 8px 32px rgba(0, 0, 0, 0.1)`

## 🔍 API文档

### Socket.IO事件

#### 客户端发送

- `join-room` - 加入房间
- `start-screen-share` - 开始屏幕共享
- `stop-screen-share` - 停止屏幕共享
- `offer` - WebRTC offer信令
- `answer` - WebRTC answer信令
- `ice-candidate` - ICE候选信令

#### 服务端发送

- `room-info` - 房间信息
- `user-joined` - 用户加入
- `user-left` - 用户离开
- `screen-share-started` - 屏幕共享开始
- `screen-share-stopped` - 屏幕共享停止

### REST API

- `GET /api/health` - 服务器健康检查
- `GET /api/rooms` - 获取活跃房间列表

## 🛠️ 开发指南

### 本地开发

1. **环境设置**
   ```bash
   # 安装开发依赖
   npm install
   
   # 启动开发模式
   npm run dev:all
   ```

2. **代码规范**
   - 使用ES6+语法
   - 遵循模块化设计
   - 添加适当的注释

3. **测试流程**
   - 在多个浏览器标签页测试
   - 验证不同屏幕分辨率
   - 测试网络异常情况

### 常见问题

**Q: 屏幕共享不工作？**
A: 确保使用HTTPS协议，HTTP环境下屏幕共享API不可用。

**Q: 无法听到音频？**
A: 检查浏览器音频权限，确保视频元素未静音。

**Q: 连接失败？**
A: 检查防火墙设置，确保WebSocket连接正常。

## 🔒 安全性

- 所有通信基于WebRTC加密
- 不存储任何用户数据
- 房间数据仅在内存中保持
- 支持HTTPS部署

## 📱 浏览器兼容性

| 浏览器 | 版本要求 | 屏幕共享 | WebRTC |
|--------|----------|----------|--------|
| Chrome | 72+ | ✅ | ✅ |
| Firefox | 66+ | ✅ | ✅ |
| Safari | 13+ | ✅ | ✅ |
| Edge | 79+ | ✅ | ✅ |

## 🤝 贡献

欢迎提交问题和功能请求！

1. Fork 项目
2. 创建特性分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 🙏 致谢

- WebRTC社区的技术支持
- Socket.IO团队的优秀框架
- 现代浏览器对Web标准的支持

---

**晶莹投屏** - 让屏幕共享变得简单而优雅 ✨